var Pager=function(el,opts){var _=this;this.autopager=!1,this.el=el,this.pager=this.el.querySelector(".negnet_utility_pager"),this.xobj=new XMLHttpRequest,this.xobj.overrideMimeType("application/json"),this.pagerItems=null,this.pager&&(this.pagerItems=this.pager.querySelector("ul")),this.opts=void 0!==opts?opts:{},this.itemsEl=el.querySelector(".items"),this.itemsEl&&(this.itemsContainer=this.itemsEl.querySelector(".items-container"),this.itemsContainer||(this.itemsContainer=this.itemsEl),this.url=this.itemsEl.dataset.endpoint,void 0!==this.url&&(this.fetchOptions=function(){const e={};for(var t in this.itemsEl.dataset)["endpoint","totalitems"].includes(t)||(e[t]=_.itemsEl.dataset[t]);return e},this.currentPage=0,this.total=_.itemsEl.dataset.totalitems,this.totalPages=Math.floor(this.total/_.itemsEl.dataset.perpage),this.firstPage=0<_.itemsContainer.children.length?1:0,this.fetch=function(page){_.currentPage=parseInt(page);const endpoint=_.getUrl()+"&page="+page;_.buildPager(),history.pushState(null,null,_.buildUrl(page)),_.itemsContainer.classList.add("dim"),_.xobj.open("GET",endpoint,!0),_.xobj.onreadystatechange=function(){if(4==_.xobj.readyState&&"200"==_.xobj.status){for(var data=JSON.parse(_.xobj.responseText),fragment=(parseInt(data.count)!=parseInt(_.total)&&(_.total=data.count,_.totalPages=Math.floor(_.total/_.itemsEl.dataset.perpage),_.buildPager()),document.createDocumentFragment()),i=0;i<data.items.length;i++){var item=data.items[i],el=createElementFromHTML(item);fragment.appendChild(el)}let scripts=fragment.querySelectorAll("script");for(let n=0;n<scripts.length;n++)eval(scripts[n].innerHTML);if(_.pager){const currentLink=_.pager.querySelector(".is-active");currentLink&&currentLink.classList.remove("Loader")}window.requestAnimationFrame(function(){_.itemsContainer.innerHTML="",_.itemsContainer.appendChild(fragment),_.itemsContainer.classList.remove("dim"),_.el.scrollIntoView({block:"start",behavior:"smooth"})})}},_.xobj.send(null)},this.buildUrl=function(e){var t=window.location.pathname;const a=new URLSearchParams(window.location.search);a.set("page",e),0==e&&a.delete("page");e=a.toString();return t+(0<e.length?"?":"")+e},this.buildPager=function(){const e=document.createDocumentFragment();var t=parseInt(9),a=(0<parseInt(_.currentPage)&&(a=createElementFromHTML("<li><a href='"+_.buildUrl(0)+"' class='pager__item pager__item--first' data-page='0'>‹‹ First</a></li>"),e.appendChild(a)),0<=parseInt(_.currentPage)-1&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)-1)+"' class='pager__item pager__item--prev' rel='prev' data-page='"+(parseInt(_.currentPage)-1)+"'>‹‹</a></li>"),e.appendChild(el)),Math.ceil(t/2)),r=parseInt(_.currentPage),n=r-a;let i=r+t-a;var s=parseInt(_.totalPages);let l=n;for(i>s&&(l+=s-i,i=s),l<0&&(i+=1-l,l=0),l!=s&&0<l&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el));l<=i&&l<=s;l++){var o=createElementFromHTML("<li><a href='"+_.buildUrl(l)+"' class='pager__item"+(l==parseInt(_.currentPage)?" is-active Loader":"")+"' data-page='"+l+"'>"+(l+1)+"</a></li>");e.appendChild(o)}i<parseInt(_.totalPages)&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el)),r+1<=parseInt(_.totalPages)&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)+1)+"' class='pager__item pager__item--next' rel='next' data-page='"+(parseInt(_.currentPage)+1)+"'>››</a></li>"),e.appendChild(el)),parseInt(_.currentPage)!=parseInt(_.totalPages)&&(t=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.totalPages))+"' class='pager__item pager__item--last' data-page='"+parseInt(_.totalPages)+"'>Last ››</a></li>"),e.appendChild(t)),_.pagerItems&&(_.pagerItems.innerHTML="",_.pagerItems.appendChild(e))},this.getUrl=function(){var e="",t=_.fetchOptions();for(a in t)e=(e+="&")+a+"="+encodeURIComponent(t[a]);if(void 0!==_.opts.fetchOptionsCallback){var a,r=_.opts.fetchOptionsCallback.call(_.opts.fetchOptionsCallbackContext);for(a in r)e=(e+="&")+a+"="+encodeURIComponent(r[a])}var n=_.url.includes("?")?"&":"?";return _.url+n+e.substring(1)},window.addEventListener("popstate",function(e){const t=new URLSearchParams(window.location.search);let a=t.get("page");a=a||0,_.fetch(a)}),this.pager&&_.pager.addEventListener("click",function(e){var t=e.target.closest("a");t&&(e.preventDefault(),e.stopPropagation(),_.fetch(t.dataset.page))}),0==_.firstPage&&_.fetch(0)))};window.pagers=new function(){const a=this;this.pagers=[],Array.prototype.forEach.call(document.querySelectorAll(".ajax-paged"),function(e){a.pagers.push(new Pager(e))}),this.getPagerByEl=function(t){for(let e=0;e<a.pagers.length;e++)if(a.pagers[e].el===t)return a.pagers[e];return null}};

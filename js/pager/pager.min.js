var Pager=function(el,opts){var _=this;if(this.autopager=!1,this.el=el,this.pager=this.el.querySelector(".negnet_utility_pager"),this.xobj=new XMLHttpRequest,this.xobj.overrideMimeType("application/json"),this.pagerItems=null,this.pager&&(this.pagerItems=this.pager.querySelector("ul")),this.opts=void 0!==opts?opts:{},this.itemsEl=el.querySelector(".items"),this.itemsEl&&(this.itemsContainer=this.itemsEl.querySelector(".items-container"),this.itemsContainer||(this.itemsContainer=this.itemsEl),this.url=this.itemsEl.dataset.endpoint,void 0!==this.url)){for(var d in this.fetchOptions={},this.itemsEl.dataset)["endpoint","totalitems"].includes(d)||(_.fetchOptions[d]=_.itemsEl.dataset[d]);this.currentPage=0,this.total=_.itemsEl.dataset.totalitems,this.totalPages=Math.floor(this.total/_.itemsEl.dataset.perpage),this.firstPage=0<_.itemsContainer.children.length?1:0,this.fetch=function(page){_.currentPage=parseInt(page);const endpoint=_.getUrl()+"&page="+page;_.buildPager(),history.pushState(null,null,_.buildUrl(page)),_.itemsContainer.classList.add("dim"),_.xobj.open("GET",endpoint,!0),_.xobj.onreadystatechange=function(){if(4==_.xobj.readyState&&"200"==_.xobj.status){for(var data=JSON.parse(_.xobj.responseText),fragment=document.createDocumentFragment(),i=0;i<data.items.length;i++){var item=data.items[i],el=createElementFromHTML(item);fragment.appendChild(el)}let scripts=fragment.querySelectorAll("script");for(let n=0;n<scripts.length;n++)eval(scripts[n].innerHTML);if(_.pager){const currentLink=_.pager.querySelector(".is-active");currentLink&&currentLink.classList.remove("Loader")}window.requestAnimationFrame(function(){_.itemsContainer.innerHTML="",_.itemsContainer.appendChild(fragment),_.itemsContainer.classList.remove("dim"),_.el.scrollIntoView({block:"start",behavior:"smooth"})})}},_.xobj.send(null)},this.buildUrl=function(e){var t=window.location.pathname;const a=new URLSearchParams(window.location.search);a.set("page",e),0==e&&a.delete("page");e=a.toString();return t+(0<e.length?"?":"")+e},this.buildPager=function(){const e=document.createDocumentFragment();var t=parseInt(9),a=(0<parseInt(_.currentPage)&&(a=createElementFromHTML("<li><a href='"+_.buildUrl(0)+"' class='pager__item pager__item--first' data-page='0'>‹‹ First</a></li>"),e.appendChild(a)),0<=parseInt(_.currentPage)-1&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)-1)+"' class='pager__item pager__item--prev' rel='prev' data-page='"+(parseInt(_.currentPage)-1)+"'>‹‹</a></li>"),e.appendChild(el)),Math.ceil(t/2)),r=parseInt(_.currentPage),i=r-a;let n=r+t-a;var s=parseInt(_.totalPages);let l=i;for(n>s&&(l+=s-n,n=s),l<0&&(n+=1-l,l=0),l!=s&&0<l&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el));l<=n&&l<=s;l++){var o=createElementFromHTML("<li><a href='"+_.buildUrl(l)+"' class='pager__item"+(l==parseInt(_.currentPage)?" is-active Loader":"")+"' data-page='"+l+"'>"+(l+1)+"</a></li>");e.appendChild(o)}n<parseInt(_.totalPages)&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el)),r+1<=parseInt(_.totalPages)&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)+1)+"' class='pager__item pager__item--next' rel='next' data-page='"+(parseInt(_.currentPage)+1)+"'>››</a></li>"),e.appendChild(el)),parseInt(_.currentPage)!=parseInt(_.totalPages)&&(t=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.totalPages))+"' class='pager__item pager__item--last' data-page='"+parseInt(_.totalPages)+"'>Last ››</a></li>"),e.appendChild(t)),_.pagerItems&&(_.pagerItems.innerHTML="",_.pagerItems.appendChild(e))},this.getUrl=function(){var e="";for(t in _.fetchOptions)e=(e+="&")+t+"="+encodeURIComponent(_.fetchOptions[t]);if(void 0!==_.opts.fetchOptionsCallback){var t,a=_.opts.fetchOptionsCallback.call(_.opts.fetchOptionsCallbackContext);for(t in a)e=(e+="&")+t+"="+encodeURIComponent(a[t])}var r=_.url.includes("?")?"&":"?";return _.url+r+e.substring(1)},window.addEventListener("popstate",function(e){const t=new URLSearchParams(window.location.search);let a=t.get("page");a=a||0,_.fetch(a)}),this.pager&&_.pager.addEventListener("click",function(e){var t=e.target.closest("a");t&&(e.preventDefault(),e.stopPropagation(),_.fetch(t.dataset.page))}),0==_.firstPage&&_.fetch(0)}},pagers=document.querySelectorAll(".ajax-paged");Array.prototype.forEach.call(pagers,function(e){new Pager(e)});

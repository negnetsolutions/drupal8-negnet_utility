var autoPager=function(endpoint,el,perPage,first_page){var _=this,count;this.next_page=first_page,this.working=!1,this.el=el,this.perPage=perPage,this.total_pages=!1,this.endpoint=endpoint,this.lastObserved,this.lastFetchCount=0,this.isLoading=!1,this.xobj=new XMLHttpRequest,this.debug=!1,this.log=function(e){_.debug&&console.debug(e)},this.calculateTotalPages=function(e){_.total_pages=Math.floor(parseInt(e,10)/parseInt(_.perPage,10))},this.clearItems=function(){_.el.innerHTML=""},this.setFinishedLoading=function(){var e=_.el.querySelector(".col.loading");null!==e&&_.el.removeChild(e),_.isLoading=!1},this.setLoading=function(){var e;_.isLoading||(e=createElementFromHTML("<div class='col loading' data-page'"+_.next_page+"'><span class='text'>Loading...</span><div class='progress'></div></div>"),_.el.appendChild(e),_.isLoading=!0)},0!==first_page?(count=_.el.dataset.initialcount,_.lastFetchCount=_.el.children.length,_.calculateTotalPages(count)):(_.clearItems(),_.setLoading()),this.observer=new IntersectionObserver(function(e){e[0].isIntersecting&&(_.unsetObserver(),_.fetch())}),this.checkIfDone=function(){return!1!==_.total_pages&&_.next_page>_.total_pages},this.fetch=function(){if(1==_.working)return!1;var endpoint;_.checkIfDone()?_.complete():(_.setLoading(),endpoint=_.endpoint()+"&page="+_.next_page,_.working=!0,this.loadJSON(endpoint,function(data){_.calculateTotalPages(data.count),_.log("Fetched page "+_.next_page+" of "+_.total_pages+" "+data.count+" items."),_.lastFetchCount=data.items.length;for(var fragment=document.createDocumentFragment(),i=0;i<data.items.length;i++){var item=data.items[i],el=createElementFromHTML(item);fragment.appendChild(el)}let scripts=fragment.querySelectorAll("script");for(let n=0;n<scripts.length;n++)eval(scripts[n].innerHTML);window.requestAnimationFrame(function(){_.setFinishedLoading(),_.el.appendChild(fragment),_.next_page++,_.working=!1,_.setObserver()})}))},this.loadJSON=function(e,t){_.log(e),_.xobj.overrideMimeType("application/json"),_.xobj.open("GET",e,!0),_.xobj.onreadystatechange=function(){var e;4==_.xobj.readyState&&"200"==_.xobj.status&&(e=JSON.parse(_.xobj.responseText),t.call(_,e))},_.xobj.send(null)},this.complete=function(){_.unsetObserver()},this.setObserver=function(){var e;0!==_.el.children.length&&(e=Math.floor(.67*_.lastFetchCount),null!==(e=_.el.children[_.el.children.length-(e=0===e?1:e)]).querySelector(".name")&&(e=e.querySelector(".name")),_.lastObserved=e,_.observer.observe(e))},this.unsetObserver=function(){_.observer.unobserve(_.lastObserved),_.xobj.abort(),_.working=!1},_.setObserver()};
